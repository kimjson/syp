# Migration `20201015123544-add-books`

This migration has been generated by jaesung at 10/15/2020, 9:35:44 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `pages` ADD COLUMN `bookId` int  

CREATE TABLE `Book` (
`id` int  NOT NULL  AUTO_INCREMENT,
`title` varchar(191)  NOT NULL ,
`isDefault` boolean  NOT NULL DEFAULT true,
`created_at` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_BookToUser` (
`A` int  NOT NULL ,
`B` int  NOT NULL ,
UNIQUE INDEX `_BookToUser_AB_unique`(`A`,
`B`),
INDEX `_BookToUser_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `_BookToUser` ADD FOREIGN KEY (`A`) REFERENCES `dbsyp`.`Book`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_BookToUser` ADD FOREIGN KEY (`B`) REFERENCES `dbsyp`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `pages` ADD FOREIGN KEY (`bookId`) REFERENCES `dbsyp`.`Book`(`id`) ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201015123249-remap-page-to-pages..20201015123544-add-books
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 /// 
 model User {
@@ -15,9 +15,10 @@
   emailVerified DateTime? @map("email_verified")
   image         String?
   createdAt     DateTime  @default(now()) @map("created_at")
   updatedAt     DateTime  @default(now()) @updatedAt @map("updated_at")
-  page          Page[]    @relation("pageTousers")
+  pages         Page[]    @relation("pageTousers")
+  books         Book[]
   @@map("users")
 }
@@ -62,8 +63,17 @@
   @@map("verification_requests")
 }
+model Book {
+  id          Int       @default(autoincrement()) @id
+  title       String
+  isDefault   Boolean   @default(true)
+  createdAt   DateTime  @default(now()) @map(name: "created_at")
+  pages       Page[]
+  users       User[]
+}
+
 model Page {
   id          Int       @id @default(autoincrement())
   title       String
   url         String
@@ -72,8 +82,10 @@
   createdAt   DateTime  @default(now())
   isRead      Int       @default(0)
   userId      Int?
   users       User?     @relation("pageTousers", fields: [userId], references: [id])
+  book        Book?     @relation(fields: [bookId], references: [id])
+  bookId      Int?
   @@map("pages")
   @@index([userId], name: "FK_ae1d917992dd0c9d9bbdad06c4a")
 }
```


